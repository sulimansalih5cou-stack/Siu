<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>كشف الحساب - Smart Dorm</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #F9FAFB;
            font-family: 'Cairo', sans-serif;
            padding-bottom: 60px;
            -webkit-user-select: none; 
            user-select: none;         
        }

        /* --- شريط التنقل العلوي --- */
        .navbar {
            position: fixed; top: 0; left: 0; right: 0;
            z-index: 900; background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            height: 64px;
            padding: 0 16px; 
            display: flex;
            align-items: center;
        }

        /* --- القائمة الجانبية --- */
        .sidebar {
            position: fixed; top: 0; right: 0; height: 100%; width: 260px;
            background: white; z-index: 1000;
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.1);
            transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding-top: 20px;
        }
        .sidebar.open { transform: translateX(0); }
        .sidebar-overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(0, 0, 0, 0.4); z-index: 999; backdrop-filter: blur(2px);
        }
        .sidebar.open + .sidebar-overlay { display: block; }

        .sidebar-link {
            display: flex; align-items: center; padding: 14px 24px;
            font-weight: 600; color: #4B5563; transition: 0.3s;
            border-radius: 0 25px 25px 0; margin-left: 15px;
        }
        .sidebar-link:hover { background: #F3F4F6; color: #B91C1C; }
        .sidebar-link.active-history { background: #FEF2F2; color: #B91C1C; }

        /* --- بطاقة الهيدر --- */
        .user-profile-card {
            background: linear-gradient(135deg, #B91C1C 0%, #7F1D1D 100%);
            color: white; padding: 35px 24px;
            border-bottom-left-radius: 30px; border-bottom-right-radius: 30px;
            margin-bottom: 25px; margin-top: 64px;
            box-shadow: 0 10px 20px rgba(185, 28, 28, 0.2);
        }

        /* --- الفلاتر العصرية --- */
        .filter-scroll {
            display: flex; gap: 12px; overflow-x: auto;
            padding: 5px 5px 15px; margin-bottom: 10px;
            scrollbar-width: none;
        }
        .filter-scroll::-webkit-scrollbar { display: none; }

        .filter-pill {
            white-space: nowrap; padding: 8px 18px;
            border-radius: 12px; background: white;
            color: #6B7280; font-size: 0.85rem; font-weight: 600;
            border: 1px solid #E5E7EB; cursor: pointer; transition: 0.3s;
        }
        .filter-pill.active {
            background: #B91C1C; color: white; border-color: #B91C1C;
            box-shadow: 0 4px 12px rgba(185, 28, 28, 0.2);
        }

        /* --- تصميم بطاقة السجل الجديد (The Modern Card) --- */
        .bankak-card {
            background: white;
            border-radius: 20px;
            margin-bottom: 16px;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(229, 231, 235, 0.5);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02);
        }
        .bankak-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }

        .bank-icon-container {
            width: 50px; height: 50px; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; flex-shrink: 0;
        }
        
        /* ألوان الحالات */
        .card-incoming-bg { background: #ECFDF5; color: #059669; }
        .card-outgoing-bg { background: #FEF2F2; color: #DC2626; }

        .details-wrapper { flex-grow: 1; margin-right: 15px; }
        .transaction-title { font-weight: 700; color: #1F2937; font-size: 1rem; }
        .transaction-sub { font-size: 0.75rem; color: #9CA3AF; margin-top: 2px; }

        .amount-display { text-align: left; order: 3; }
        .amount-value { font-size: 1.15rem; font-weight: 800; font-family: sans-serif; display: block; }
        .amount-label { font-size: 0.65rem; color: #9CA3AF; font-weight: 600; }

        /* --- المودال والأزرار --- */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(4px); }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 25px; border-radius: 24px; width: 90%; max-width: 400px; }
        
        .btn-primary {
            background: #B91C1C; color: white; padding: 12px; border-radius: 12px;
            font-weight: 600; width: 100%; transition: 0.3s;
        }
        .btn-primary:hover { background: #991B1B; transform: scale(1.02); }

    </style>
</head>
<body>

    <nav class="navbar">
        <button id="menuButton" class="text-2xl text-gray-600 p-2"><i class="fas fa-bars"></i></button>
        <div class="flex-grow text-center font-bold text-gray-800 text-lg">سجل المعاملات</div>
        <button id="notificationButton" class="relative p-2" onclick="showNotifications()">
            <i class="fas fa-bell text-xl text-gray-500"></i>
            <span id="notificationBadge" class="absolute top-1 right-1 px-1.5 py-0.5 text-xs font-bold text-white bg-red-600 rounded-full hidden">0</span>
        </button>
    </nav>

    <div id="sidebar" class="sidebar">
        <div class="p-6 border-b">
            <h3 class="font-bold text-gray-800" id="sidebarUserName">جاري التحميل...</h3>
            <p class="text-xs text-gray-500" id="sidebarUserEmail">...</p>
        </div>
        <div class="mt-4">
            <a href="index.html" class="sidebar-link"><i class="fas fa-plus-circle ml-3"></i> إضافة مصروف</a>
            <a href="my_expenses.html" class="sidebar-link"><i class="fas fa-wallet ml-3"></i> مصروفاتي</a>
            <a href="history.html" class="sidebar-link active-history"><i class="fas fa-history ml-3"></i> السجل</a>
            <a href="summary.html" class="sidebar-link"><i class="fas fa-exchange-alt ml-3"></i> التسويات</a>
            <a href="#" id="logoutSidebarButton" class="sidebar-link text-red-600 mt-10"><i class="fas fa-sign-out-alt ml-3"></i> تسجيل الخروج</a>
        </div>
    </div>
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="closeSidebar()"></div>

    <div class="user-profile-card">
        <div class="flex justify-between items-center">
            <div>
                <p class="text-red-200 text-sm">إجمالي النشاط</p>
                <h2 class="text-2xl font-bold">مرحباً، <span id="displayHeaderName">...</span></h2>
            </div>
            <div class="bg-white bg-opacity-20 p-3 rounded-2xl">
                <i class="fas fa-receipt text-2xl"></i>
            </div>
        </div>
    </div>

    <div class="max-w-3xl mx-auto px-4">
        <div class="filter-scroll" id="filtersContainer">
            <div class="filter-pill active" onclick="setFilterWithProtection('30days', this)">آخر 30 يوم</div>
            <div class="filter-pill" onclick="setFilterWithProtection('3months', this)">آخر 3 شهور</div>
            <div class="filter-pill" onclick="setFilterWithProtection('incoming', this)">الواردة</div>
            <div class="filter-pill" onclick="setFilterWithProtection('outgoing', this)">الصادرة</div>
        </div>

        <div id="expensesContainer" class="space-y-1">
            <div class="text-center py-20 text-gray-400">
                <i class="fas fa-circle-notch fa-spin fa-2xl mb-4"></i>
                <p>جاري تحديث سجلاتك...</p>
            </div>
        </div>

        <button id="loadMoreButton" onclick="loadMoreHistoryWithProtection()" class="btn-primary mt-6 hidden">
            عرض سجلات أقدم
        </button>
    </div>

    <div id="notificationModal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-bell ml-2 text-red-600"></i> الإشعارات</h2>
            <div id="notificationsList" class="space-y-3 max-h-80 overflow-y-auto"></div>
            <button onclick="hideNotificationModal()" class="btn-primary mt-6 bg-gray-100 !text-gray-600 shadow-none">إغلاق</button>
        </div>
    </div>

    <script>
        /* المنطق البرمجي للحماية والتحكم في الواجهة */
        let isFiltering = false;

        window.setFilterWithProtection = function(filterType, element) {
            if (isFiltering) return;
            isFiltering = true;
            
            document.querySelectorAll('.filter-pill').forEach(el => el.classList.remove('active'));
            element.classList.add('active');

            if (window.setFilter) window.setFilter(filterType, element);
            setTimeout(() => isFiltering = false, 500);
        };

        window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('open');
        window.closeSidebar = () => document.getElementById('sidebar').classList.remove('open');
        
        document.getElementById('menuButton').onclick = window.toggleSidebar;

        // منع النسخ
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'c') e.preventDefault();
        });
    </script>

    <script src="script.js" type="module"></script>
</body>
</html>
